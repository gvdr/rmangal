<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Basics of rmangal}
-->

```{r load}
library(devtools)
devtools::install_github('rmangal','mangal-wg')
library(rmangal)
```

# rmangal - R access to hosted MANGAL API

The `mangal` project is a [data specification][dataspec] and [API][api],
desgined to facilitate the retrieval, archival, and re-use of data on
ecological interactions.

# An overview of the mangal format

The database (and underlying data format) is built around the idea that networks required meta-data to be fully understood. Instead of presenting them as 0/1 matrices, the `mangal` data format uses relations between objects as small as a possible. So as to understand the different elements, let's connect to a server implementing the API:

```{r firstStep}
netdb <- mangalapi('http://localhost:8000')
```

The `netdb` object has all the necessary informations for the `rmangal` package to work (and is the first argument of many functions). Let's look at the names of this object:

```{r methodsOK}
names(netdb)
```

Note that if you are logged-in at this point (see the vignette about *Contributing data*), `netdb` will gain the attributes `auth` and `me`, so let's disregard these. Each element in this array corresponds to a *resource*, *i.e.* a type of object you can interact with. The data specification is a description of (i) the content of each field, and (ii) how it should be formatted. As no one is supposed to remember the whole data specification, a function called `whatIs` will give you a brief overview of what each field is supposed to mean:

```{r whatIs}
whatIs(netdb, 'taxa')
```

The `rmangal` package will return you objects as `list`s, and (in case you want to contribute data), will expect objects in the same format. In the `data.frame` returned by `whatIs`, there are all the informations to understand the objects that are returned. If you are not interested in contributing data, you will most likely be OK with the first two columns: the name of the field, and what it means. For example, this data frame gives you all the meta-data associated with a taxa. The `null` column will also tell you which fields are facultative, and which are mandatory.

Let's compare this output with a `taxa` object pulled from the database (we'll see each element of the data structure and how to access it just after):

```{r showtaxa}
getTaxa(netdb, 1)
```

## Describing nodes

Nodes in the networks can be of type `taxa`, `population`, and `item`. Calling `whatIs` on `item` or `population` will show that `population`s are linked to a `taxa`, and that `item`s are linked to a population. Here are the reasons why.

## Describing interactions

## Meta-data

# Pulling data from the database

The data can be accessed with either `get*` or `list*`. A function starting with `get` will retrieve a *single* record, identified by its `id`. A function starting by `list` will return *all* records of a given type (options to filter will be added in future releases). All the functions follow the same naming convention: either `get` or `list`, and the name of the resource (`taxa`, `reference`) with its first letter capitalized. So getting a list of all networks with their name, unique identifier, and number of interactions, is as simple as

```{r listnetwork}
head(ldply(listNetwork(netdb), summarize, id = id, name = name, n_int = length(interactions)))
```

If we want to have a look at  the first network, we simply need to write

```{r getnetwork}
(net1 <- getNetwork(netdb, 1))
```

And similarly, the content of the first interaction of this network is 

```{r firstInterac}
(int1 <- getInteraction(netdb, net1$interactions[1]))
```

# Example: plotting a network