<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Basics of rmangal}
-->




<h1 id="rmangal---r-access-to-hosted-mangal-api">rmangal - R access to hosted MANGAL API</h1>
<p>The <code>mangal</code> project is a <a href="http://mangal.uqar.ca/doc/spec/">data specification</a> and <a href="http://mangal.uqar.ca/api/v1/?format=json">API</a>, desgined to facilitate the retrieval, archival, and re-use of data on ecological interactions.</p>
<h1 id="an-overview-of-the-mangal-format">An overview of the mangal format</h1>
<p>The database (and underlying data format) is built around the idea that networks required meta-data to be fully understood. Instead of presenting them as 0/1 matrices, the <code>mangal</code> data format uses relations between objects as small as a possible. So as to understand the different elements, let's connect to a server implementing the API:</p>
<pre class="sourceCode r"><code class="sourceCode r">netdb &lt;-<span class="st"> </span><span class="kw">mangalapi</span>(<span class="st">&quot;http://localhost:8000&quot;</span>)</code></pre>
<p>The <code>netdb</code> object has all the necessary informations for the <code>rmangal</code> package to work (and is the first argument of many functions). Let's look at the names of this object:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(netdb)</code></pre>
<pre><code>##  [1] &quot;base&quot;        &quot;trail&quot;       &quot;dataset&quot;     &quot;environment&quot; &quot;interaction&quot;
##  [6] &quot;item&quot;        &quot;network&quot;     &quot;population&quot;  &quot;reference&quot;   &quot;taxa&quot;       
## [11] &quot;trait&quot;       &quot;user&quot;</code></pre>
<p>Note that if you are logged-in at this point (see the vignette about <em>Contributing data</em>), <code>netdb</code> will gain the attributes <code>auth</code> and <code>me</code>, so let's disregard these. Each element in this array corresponds to a <em>resource</em>, <em>i.e.</em> a type of object you can interact with. The data specification is a description of (i) the content of each field, and (ii) how it should be formatted. As no one is supposed to remember the whole data specification, a function called <code>whatIs</code> will give you a brief overview of what each field is supposed to mean:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">whatIs</span>(netdb, <span class="st">&quot;taxa&quot;</span>)</code></pre>
<pre><code>##         field                                        help    type  null
## 1        bold             The BOLD identifier of the taxa integer  TRUE
## 2 description             A short description of the taxa  string  TRUE
## 3        gbif             The GBIF identifier of the taxa integer  TRUE
## 5        itis             The ITIS identifier of the taxa integer  TRUE
## 6        name             The scientific name of the taxa  string FALSE
## 7        ncbi    The NCBI Taxonomy identifier of the taxa integer  TRUE
## 9  vernacular The vernacular name of the taxa, in English  string FALSE
##   unique values
## 1   TRUE       
## 2  FALSE       
## 3   TRUE       
## 5   TRUE       
## 6   TRUE       
## 7   TRUE       
## 9  FALSE</code></pre>
<p>The <code>rmangal</code> package will return you objects as <code>list</code>s, and (in case you want to contribute data), will expect objects in the same format. In the <code>data.frame</code> returned by <code>whatIs</code>, there are all the informations to understand the objects that are returned. If you are not interested in contributing data, you will most likely be OK with the first two columns: the name of the field, and what it means. For example, this data frame gives you all the meta-data associated with a taxa. The <code>null</code> column will also tell you which fields are facultative, and which are mandatory.</p>
<p>Let's compare this output with a <code>taxa</code> object pulled from the database (we'll see each element of the data structure and how to access it just after):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getTaxa</span>(netdb, <span class="dv">1</span>)</code></pre>
<pre><code>## $bold
## NULL
## 
## $description
## NULL
## 
## $gbif
## NULL
## 
## $id
## [1] &quot;1&quot;
## 
## $itis
## NULL
## 
## $name
## [1] &quot;Urospermum picrioides&quot;
## 
## $ncbi
## NULL
## 
## $owner
## [1] &quot;tpoisot&quot;
## 
## $vernacular
## [1] &quot;&quot;</code></pre>
<h2 id="describing-nodes">Describing nodes</h2>
<p>Nodes in the networks can be of type <code>taxa</code>, <code>population</code>, and <code>item</code>. Calling <code>whatIs</code> on <code>item</code> or <code>population</code> will show that <code>population</code>s are linked to a <code>taxa</code>, and that <code>item</code>s are linked to a population. Here are the reasons why.</p>
<h2 id="describing-interactions">Describing interactions</h2>
<h2 id="meta-data">Meta-data</h2>
<h1 id="pulling-data-from-the-database">Pulling data from the database</h1>
<p>The data can be accessed with either <code>get*</code> or <code>list*</code>. A function starting with <code>get</code> will retrieve a <em>single</em> record, identified by its <code>id</code>. A function starting by <code>list</code> will return <em>all</em> records of a given type (options to filter will be added in future releases). All the functions follow the same naming convention: either <code>get</code> or <code>list</code>, and the name of the resource (<code>taxa</code>, <code>reference</code>) with its first letter capitalized. So getting a list of all networks with their name, unique identifier, and number of interactions, is as simple as</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">ldply</span>(<span class="kw">listNetwork</span>(netdb), summarize, <span class="dt">id =</span> id, <span class="dt">name =</span> name, <span class="dt">n_int =</span> <span class="kw">length</span>(interactions)))</code></pre>
<pre><code>## 11 object(s) found</code></pre>
<pre><code>##   id   name n_int
## 1  1 BAT1CA    52
## 2  2 BAT2CA   113
## 3  3 FRA1OP    46
## 4  4 FRA2OP    55
## 5  5 MED1CA    60
## 6  6 MED2CA   117</code></pre>
<p>If we want to have a look at the first network, we simply need to write</p>
<pre class="sourceCode r"><code class="sourceCode r">(net1 &lt;-<span class="st"> </span><span class="kw">getNetwork</span>(netdb, <span class="dv">1</span>))</code></pre>
<pre><code>## $date
## NULL
## 
## $description
## NULL
## 
## $environment
## list()
## 
## $id
## [1] &quot;1&quot;
## 
## $interactions
##  [1] &quot;1&quot;  &quot;2&quot;  &quot;3&quot;  &quot;4&quot;  &quot;5&quot;  &quot;6&quot;  &quot;7&quot;  &quot;8&quot;  &quot;9&quot;  &quot;10&quot; &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot;
## [15] &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;20&quot; &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot;
## [29] &quot;29&quot; &quot;30&quot; &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;40&quot; &quot;41&quot; &quot;42&quot;
## [43] &quot;43&quot; &quot;44&quot; &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;50&quot; &quot;51&quot; &quot;52&quot;
## 
## $latitude
## NULL
## 
## $longitude
## NULL
## 
## $metaweb
## [1] FALSE
## 
## $name
## [1] &quot;BAT1CA&quot;
## 
## $owner
## [1] &quot;tpoisot&quot;</code></pre>
<p>And similarly, the content of the first interaction of this network is</p>
<pre class="sourceCode r"><code class="sourceCode r">(int1 &lt;-<span class="st"> </span><span class="kw">getInteraction</span>(netdb, net1$interactions[<span class="dv">1</span>]))</code></pre>
<pre><code>## $description
## NULL
## 
## $ecotype
## [1] &quot;pollination&quot;
## 
## $id
## [1] &quot;1&quot;
## 
## $item_from
## NULL
## 
## $item_to
## NULL
## 
## $owner
## [1] &quot;tpoisot&quot;
## 
## $pop_from
## NULL
## 
## $pop_to
## NULL
## 
## $strength_f
## [1] 0.1667
## 
## $strength_t
## NULL
## 
## $taxa_from
## [1] &quot;33&quot;
## 
## $taxa_to
## [1] &quot;1&quot;
## 
## $units_f
## [1] &quot;visits per minute&quot;
## 
## $units_t
## NULL</code></pre>
<p>To get a sense of what each property mean, you simply need to call <code>whatIs(netdb, 'interaction')</code>.</p>
<h1 id="example-plotting-a-network">Example: plotting a network</h1>
<p>With this information in hand, getting a full network with all taxa information is simply a matter of following each interaction down to the taxa level, and putting this together in a single object. It's easy, but tedious. The <code>network_as_graph</code> function will take care of it automatically, and pull a network a an <code>igraph</code> object:</p>
<pre class="sourceCode r"><code class="sourceCode r">G &lt;-<span class="st"> </span><span class="kw">network_as_graph</span>(netdb, <span class="dv">1</span>)
A &lt;-<span class="st"> </span><span class="kw">get.adjacency</span>(G, <span class="dt">sparse =</span> <span class="ot">FALSE</span>)
A &lt;-<span class="st"> </span>A[-<span class="kw">which</span>(<span class="kw">rowSums</span>(A) ==<span class="st"> </span><span class="dv">0</span>), -<span class="kw">which</span>(<span class="kw">colSums</span>(A) ==<span class="st"> </span><span class="dv">0</span>)]
<span class="kw">visweb</span>(A)</code></pre>
<div class="figure">
<img src="figure/unnamed-chunk-1.png" alt="A visualisation of the network." /><p class="caption">A visualisation of the network.</p>
</div>
